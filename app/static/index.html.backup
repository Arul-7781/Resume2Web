<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio Builder</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }
        
        /* Light Theme (Default) */
        :root {
            --bg-primary: #F8FAFC;
            --bg-surface: #FFFFFF;
            --border: #E2E8F0;
            --text-primary: #0F172A;
            --text-secondary: #475569;
            --accent-primary: #7C3AED;
            --accent-secondary: #0891B2;
            --success: #16A34A;
            --error: #DC2626;
        }
        
        /* Dark Theme */
        .dark-theme {
            --bg-primary: #0F172A;
            --bg-surface: #1E293B;
            --border: #334155;
            --text-primary: #E5E7EB;
            --text-secondary: #94A3B8;
            --accent-primary: #8B5CF6;
            --accent-secondary: #22D3EE;
            --success: #22C55E;
            --error: #EF4444;
        }
        
        body {
            background: var(--bg-primary);
            color: var(--text-primary);
            transition: all 0.2s ease;
        }
        
        .card {
            background: var(--bg-surface);
            border: 1px solid var(--border);
            transition: all 0.2s ease;
        }
        
        .btn-primary {
            background: var(--accent-primary);
            color: white;
            transition: all 0.2s ease;
        }
        
        .btn-primary:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }
        
        .btn-secondary {
            background: transparent;
            border: 1px solid var(--accent-secondary);
            color: var(--accent-secondary);
            transition: all 0.2s ease;
        }
        
        .btn-secondary:hover {
            background: var(--accent-secondary);
            color: white;
        }
        
        .tab-button {
            color: var(--text-secondary);
            border-bottom: 2px solid transparent;
            transition: all 0.2s ease;
        }
        
        .tab-button.active {
            color: var(--accent-primary);
            border-bottom-color: var(--accent-primary);
            font-weight: 600;
        }
        
        .loading {
            border: 3px solid var(--border);
            border-top: 3px solid var(--accent-primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .upload-area {
            border: 2px dashed var(--border);
            background: var(--bg-surface);
            transition: all 0.2s ease;
        }
        
        .upload-area:hover {
            border-color: var(--accent-primary);
            background: var(--bg-primary);
        }
        
        input, textarea, select {
            background: var(--bg-surface);
            border: 1px solid var(--border);
            color: var(--text-primary);
        }
        
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.1);
        }
        
        .dark-theme input:focus,
        .dark-theme textarea:focus,
        .dark-theme select:focus {
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.2);
        }
        
        .preview-modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 50;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }
        
        .preview-content {
            width: 100%;
            max-width: 1400px;
            height: 90vh;
            background: var(--bg-surface);
            border-radius: 12px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .preview-iframe {
            flex: 1;
            width: 100%;
            border: none;
        }
        
        .dark-theme .form-section p {
            color: var(--text-secondary);
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Dark mode toggle */
        .theme-toggle {
            position: relative;
            width: 60px;
            height: 30px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .theme-toggle-slider {
            position: absolute;
            top: 3px;
            left: 3px;
            width: 24px;
            height: 24px;
            background: white;
            border-radius: 50%;
            transition: all 0.3s;
        }
        .dark-theme .theme-toggle-slider {
            transform: translateX(30px);
        }
        
        input, textarea, select {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border-color: var(--border-color);
        }
        
        input:focus, textarea:focus, select:focus {
            background: var(--bg-secondary);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-50 min-h-screen">
    
    <!-- Header -->
    <header class="gradient-bg shadow-2xl">
        <div class="container mx-auto px-6 py-6">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-4xl font-bold text-white flex items-center gap-3">
                        <span class="text-5xl">üöÄ</span>
                        Portfolio Builder
                    </h1>
                    <p class="text-indigo-100 mt-2">Transform your resume into a stunning portfolio in seconds</p>
                </div>
                <div class="flex items-center gap-6">
                    <div class="hidden md:flex items-center gap-4 text-white">
                        <div class="flex items-center gap-2">
                            <span class="text-2xl">‚ö°</span>
                            <span class="text-sm">AI-Powered</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="text-2xl">üé®</span>
                            <span class="text-sm">Beautiful Design</span>
                        </div>
                    </div>
                    <div class="flex items-center gap-3">
                        <span class="text-white text-sm">‚òÄÔ∏è</span>
                        <div class="theme-toggle" onclick="toggleDarkMode()">
                            <div class="theme-toggle-slider"></div>
                        </div>
                        <span class="text-white text-sm">üåô</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-6 py-12">
        
        <!-- Tabs -->
        <div class="card rounded-2xl shadow-2xl mb-8 overflow-hidden">
            <div class="flex border-b border-gray-200">
                <button onclick="switchTab('upload')" id="tab-upload" class="tab-active flex-1 px-8 py-4 font-semibold text-lg transition-all">
                    üì§ AI Upload
                </button>
                <button onclick="switchTab('manual')" id="tab-manual" class="flex-1 px-8 py-4 font-semibold text-lg text-gray-600 hover:bg-gray-50 transition-all">
                    ‚úçÔ∏è Manual Entry
                </button>
            </div>

            <!-- Tab Content -->
            <div class="p-8">
                
                <!-- Upload Tab -->
                <div id="content-upload">
                    <div class="text-center mb-8">
                        <h2 class="text-3xl font-bold text-gray-800 mb-3">Upload Your Resume</h2>
                        <p class="text-gray-600 text-lg">Let AI extract your information automatically from your PDF resume</p>
                    </div>
                    
                    <div class="upload-area max-w-2xl mx-auto border-3 border-dashed border-indigo-300 rounded-2xl p-12 text-center cursor-pointer bg-white">
                        <input type="file" id="resumeFile" accept=".pdf" class="hidden" onchange="handleFileUpload(event)">
                        <label for="resumeFile" class="cursor-pointer block">
                            <div class="text-8xl mb-6">üìÑ</div>
                            <p class="text-2xl font-bold text-gray-800 mb-2">Drop your PDF here</p>
                            <p class="text-lg text-gray-600 mb-4">or click to browse</p>
                            <div class="inline-block bg-gradient-to-r from-indigo-500 to-purple-600 text-white px-8 py-3 rounded-full font-semibold hover:shadow-lg transition">
                                Choose File
                            </div>
                        </label>
                    </div>

                    <div id="uploadProgress" class="hidden mt-8 max-w-2xl mx-auto">
                        <div class="bg-white rounded-xl p-6 shadow-lg">
                            <div class="flex items-center justify-center gap-4">
                                <div class="loading"></div>
                                <div>
                                    <p class="text-lg font-semibold text-gray-800">Analyzing your resume...</p>
                                    <p class="text-sm text-gray-600">AI is extracting your information</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="uploadError" class="hidden mt-6 max-w-2xl mx-auto bg-red-50 border-l-4 border-red-500 text-red-700 px-6 py-4 rounded-lg shadow"></div>
                </div>

                <!-- Manual Entry Tab -->
                <div id="content-manual" class="hidden">
                    <div class="text-center mb-8">
                        <h2 class="text-3xl font-bold text-gray-800 mb-3">Build Your Portfolio</h2>
                        <p class="text-gray-600 text-lg">Fill in your details manually to create your portfolio</p>
                    </div>

                    <form id="manualForm" class="max-w-4xl mx-auto space-y-8">
                        
                        <!-- Personal Info -->
                        <div class="form-section bg-white p-6 rounded-xl shadow-md border-l-4 border-indigo-500">
                            <h3 class="text-2xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                                <span>üë§</span> Personal Information
                            </h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <input type="text" id="name" placeholder="Full Name *" required class="px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition">
                                <input type="email" id="email" placeholder="Email *" required class="px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition">
                                <input type="tel" id="phone" placeholder="Phone Number" class="px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition">
                                <input type="text" id="location" placeholder="Location (City, Country)" class="px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition">
                                <input type="url" id="linkedin" placeholder="LinkedIn URL (optional)" class="px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition">
                                <input type="url" id="github" placeholder="GitHub URL (optional)" class="px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition">
                            </div>
                            <textarea id="bio" placeholder="Professional Summary / Bio" rows="4" class="w-full mt-4 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition"></textarea>
                        </div>

                        <!-- Skills -->
                        <div class="form-section bg-white p-6 rounded-xl shadow-md border-l-4 border-purple-500">
                            <h3 class="text-2xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                                <span>‚ö°</span> Skills
                            </h3>
                            <input type="text" id="skills" placeholder="Python, JavaScript, React, Node.js, Docker (comma-separated)" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition">
                            <p class="text-sm text-gray-500 mt-2">Separate each skill with a comma</p>
                        </div>

                        <!-- Theme Selector -->
                        <div class="form-section bg-white p-6 rounded-xl shadow-md border-l-4 border-pink-500">
                            <h3 class="text-2xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                                <span>üé®</span> Portfolio Theme
                            </h3>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <label class="theme-option cursor-pointer">
                                    <input type="radio" name="theme" value="minimal" class="hidden peer">
                                    <div class="border-2 border-gray-300 rounded-lg p-4 hover:border-pink-500 peer-checked:border-pink-500 peer-checked:bg-pink-50 transition">
                                        <div class="text-3xl mb-2">‚ú®</div>
                                        <h4 class="font-bold">Minimal</h4>
                                        <p class="text-sm text-gray-600">Clean & Simple</p>
                                    </div>
                                </label>
                                <label class="theme-option cursor-pointer">
                                    <input type="radio" name="theme" value="professional" checked class="hidden peer">
                                    <div class="border-2 border-gray-300 rounded-lg p-4 hover:border-pink-500 peer-checked:border-pink-500 peer-checked:bg-pink-50 transition">
                                        <div class="text-3xl mb-2">üíº</div>
                                        <h4 class="font-bold">Professional</h4>
                                        <p class="text-sm text-gray-600">Corporate & Elegant</p>
                                    </div>
                                </label>
                                <label class="theme-option cursor-pointer">
                                    <input type="radio" name="theme" value="creative" class="hidden peer">
                                    <div class="border-2 border-gray-300 rounded-lg p-4 hover:border-pink-500 peer-checked:border-pink-500 peer-checked:bg-pink-50 transition">
                                        <div class="text-3xl mb-2">üé®</div>
                                        <h4 class="font-bold">Creative</h4>
                                        <p class="text-sm text-gray-600">Bold & Artistic</p>
                                    </div>
                                </label>
                            </div>
                            <div class="mt-4">
                                <label class="flex items-center gap-3 cursor-pointer">
                                    <input type="checkbox" id="themeDarkMode" class="w-5 h-5 text-pink-500 rounded focus:ring-pink-500">
                                    <span class="text-gray-700 font-medium">Enable Dark Mode for Portfolio</span>
                                </label>
                            </div>
                        </div>

                        <!-- Experience -->
                        <div class="form-section bg-white p-6 rounded-xl shadow-md border-l-4 border-blue-500">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-2xl font-bold text-gray-800 flex items-center gap-2">
                                    <span>üíº</span> Work Experience
                                </h3>
                                <button type="button" onclick="addExperience()" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition text-sm font-semibold">
                                    + Add Experience
                                </button>
                            </div>
                            <div id="experienceContainer" class="space-y-4">
                                <!-- Experience entries will be added here -->
                            </div>
                        </div>

                        <!-- Education -->
                        <div class="form-section bg-white p-6 rounded-xl shadow-md border-l-4 border-green-500">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-2xl font-bold text-gray-800 flex items-center gap-2">
                                    <span>üéì</span> Education
                                </h3>
                                <button type="button" onclick="addEducation()" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition text-sm font-semibold">
                                    + Add Education
                                </button>
                            </div>
                            <div id="educationContainer" class="space-y-4">
                                <!-- Education entries will be added here -->
                            </div>
                        </div>

                        <!-- Projects -->
                        <div class="form-section bg-white p-6 rounded-xl shadow-md border-l-4 border-orange-500">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-2xl font-bold text-gray-800 flex items-center gap-2">
                                    <span>üöÄ</span> Projects
                                </h3>
                                <button type="button" onclick="addProject()" class="bg-orange-500 text-white px-4 py-2 rounded-lg hover:bg-orange-600 transition text-sm font-semibold">
                                    + Add Project
                                </button>
                            </div>
                            <div id="projectsContainer" class="space-y-4">
                                <!-- Project entries will be added here -->
                            </div>
                        </div>

                        <button type="submit" class="btn-primary w-full text-white py-4 rounded-xl font-bold text-lg shadow-lg">
                            Create Portfolio ‚Üí
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Parsed Data Preview -->
        <div id="dataPreview" class="hidden bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-2xl font-bold mb-4">üìã Your Portfolio Data</h2>
            
            <!-- Theme Selector for AI Parsed Data -->
            <div class="form-section bg-gradient-to-r from-pink-50 to-purple-50 p-6 rounded-xl shadow-md border-l-4 border-pink-500 mb-6">
                <h3 class="text-2xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                    <span>üé®</span> Choose Your Portfolio Theme
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <label class="theme-option cursor-pointer">
                        <input type="radio" name="aiTheme" value="minimal" class="hidden peer">
                        <div class="border-2 border-gray-300 bg-white rounded-lg p-4 hover:border-pink-500 peer-checked:border-pink-500 peer-checked:bg-pink-100 transition">
                            <div class="text-3xl mb-2">‚ú®</div>
                            <h4 class="font-bold">Minimal</h4>
                            <p class="text-sm text-gray-600">Clean & Simple</p>
                        </div>
                    </label>
                    <label class="theme-option cursor-pointer">
                        <input type="radio" name="aiTheme" value="professional" checked class="hidden peer">
                        <div class="border-2 border-gray-300 bg-white rounded-lg p-4 hover:border-pink-500 peer-checked:border-pink-500 peer-checked:bg-pink-100 transition">
                            <div class="text-3xl mb-2">üíº</div>
                            <h4 class="font-bold">Professional</h4>
                            <p class="text-sm text-gray-600">Corporate & Elegant</p>
                        </div>
                    </label>
                    <label class="theme-option cursor-pointer">
                        <input type="radio" name="aiTheme" value="creative" class="hidden peer">
                        <div class="border-2 border-gray-300 bg-white rounded-lg p-4 hover:border-pink-500 peer-checked:border-pink-500 peer-checked:bg-pink-100 transition">
                            <div class="text-3xl mb-2">üé®</div>
                            <h4 class="font-bold">Creative</h4>
                            <p class="text-sm text-gray-600">Bold & Artistic</p>
                        </div>
                    </label>
                </div>
                <div class="mt-4">
                    <label class="flex items-center gap-3 cursor-pointer">
                        <input type="checkbox" id="aiThemeDarkMode" class="w-5 h-5 text-pink-500 rounded focus:ring-pink-500">
                        <span class="text-gray-700 font-medium">üåô Enable Dark Mode for Portfolio</span>
                    </label>
                </div>
            </div>
            
            <!-- Validation Results -->
            <div id="validationResults" class="hidden mb-6"></div>
            
            <div id="previewContent" class="bg-gray-50 p-4 rounded-lg overflow-auto max-h-96">
                <pre id="jsonPreview" class="text-sm"></pre>
            </div>
            
            <!-- Platform Selector -->
            <div class="mt-6 bg-gradient-to-r from-blue-50 to-green-50 p-6 rounded-xl border-2 border-blue-200">
                <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                    <span>üöÄ</span> Choose Deployment Platform
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <label class="cursor-pointer">
                        <input type="radio" name="platform" value="netlify" class="hidden peer">
                        <div class="border-2 border-gray-300 bg-white rounded-lg p-4 hover:border-blue-500 peer-checked:border-blue-500 peer-checked:bg-blue-100 transition">
                            <div class="flex items-center justify-between mb-2">
                                <h4 class="font-bold text-lg">Netlify</h4>
                                <div class="text-2xl">üì¶</div>
                            </div>
                            <p class="text-sm text-gray-600 mb-2">Mature platform with great DX</p>
                            <p class="text-xs text-orange-600 font-semibold">‚ö†Ô∏è 100 GB/month limit</p>
                        </div>
                    </label>
                    <label class="cursor-pointer">
                        <input type="radio" name="platform" value="cloudflare" checked class="hidden peer">
                        <div class="border-2 border-gray-300 bg-white rounded-lg p-4 hover:border-green-500 peer-checked:border-green-500 peer-checked:bg-green-100 transition">
                            <div class="flex items-center justify-between mb-2">
                                <h4 class="font-bold text-lg">Cloudflare Pages</h4>
                                <div class="text-2xl">‚ö°</div>
                            </div>
                            <p class="text-sm text-gray-600 mb-2">Global CDN, blazing fast</p>
                            <p class="text-xs text-green-600 font-semibold">‚úÖ UNLIMITED bandwidth</p>
                        </div>
                    </label>
                </div>
                <div class="text-xs text-gray-500">
                    üí° Cloudflare Pages is recommended for production use (no bandwidth limits!)
                </div>
            </div>
            
            <div class="mt-6 flex gap-4">
                <button onclick="showPortfolioPreview()" class="flex-1 bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition">
                    üëÅÔ∏è Preview Website
                </button>
                <button onclick="editData()" class="flex-1 bg-gray-600 text-white py-3 rounded-lg font-semibold hover:bg-gray-700 transition">
                    ‚úèÔ∏è Edit Data
                </button>
                <button onclick="publishPortfolio()" id="publishBtn" class="flex-1 bg-green-600 text-white py-3 rounded-lg font-semibold hover:bg-green-700 transition">
                    üöÄ Publish Portfolio
                </button>
            </div>

            <div id="publishProgress" class="hidden mt-4">
                <div class="flex items-center justify-center gap-3">
                    <div class="loading"></div>
                    <span class="text-gray-600">Generating and deploying your portfolio...</span>
                </div>
            </div>
        </div>

        <!-- Success Result -->
        <div id="successResult" class="hidden bg-white rounded-lg shadow-lg p-6">
            <div class="text-center">
                <div class="text-6xl mb-4">üéâ</div>
                <h2 class="text-3xl font-bold text-green-600 mb-4">Portfolio Published Successfully!</h2>
                
                <div class="bg-green-50 border border-green-200 rounded-lg p-6 mb-6">
                    <p class="text-gray-700 mb-3">Your portfolio is now live at:</p>
                    <a id="siteUrl" href="#" target="_blank" class="text-xl font-semibold text-blue-600 hover:underline block mb-4"></a>
                    
                    <p class="text-gray-700 mb-3">Download your resume:</p>
                    <a id="pdfUrl" href="#" target="_blank" class="text-lg text-blue-600 hover:underline block">üì• Download PDF Resume</a>
                </div>

                <button onclick="resetForm()" class="bg-blue-600 text-white px-8 py-3 rounded-lg font-semibold hover:bg-blue-700 transition">
                    Create Another Portfolio
                </button>
            </div>
        </div>

    </main>

    <!-- Preview Modal -->
    <div id="previewModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-2xl w-full max-w-6xl max-h-[90vh] flex flex-col">
            <div class="flex items-center justify-between p-4 border-b">
                <h3 class="text-xl font-bold text-gray-800">Portfolio Preview</h3>
                <button onclick="closePreviewModal()" class="text-gray-500 hover:text-gray-700 text-2xl">√ó</button>
            </div>
            <div class="flex-1 overflow-hidden">
                <iframe id="previewFrame" class="w-full h-full border-0"></iframe>
            </div>
            <div class="p-4 border-t flex gap-4">
                <button onclick="closePreviewModal()" class="flex-1 bg-gray-600 text-white py-3 rounded-lg font-semibold hover:bg-gray-700 transition">
                    Close Preview
                </button>
                <button onclick="closePreviewModal(); publishPortfolio();" class="flex-1 bg-green-600 text-white py-3 rounded-lg font-semibold hover:bg-green-700 transition">
                    üöÄ Looks Good - Publish Now!
                </button>
            </div>
        </div>
    </div>

    <script>
        let portfolioData = null;
        let experienceCount = 0;
        let educationCount = 0;
        let projectCount = 0;

        // Tab switching
        function switchTab(tab) {
            document.getElementById('content-upload').classList.toggle('hidden', tab !== 'upload');
            document.getElementById('content-manual').classList.toggle('hidden', tab !== 'manual');
            
            if (tab === 'upload') {
                document.getElementById('tab-upload').classList.add('tab-active');
                document.getElementById('tab-upload').classList.remove('text-gray-600', 'hover:bg-gray-50');
                document.getElementById('tab-manual').classList.remove('tab-active');
                document.getElementById('tab-manual').classList.add('text-gray-600');
            } else {
                document.getElementById('tab-manual').classList.add('tab-active');
                document.getElementById('tab-manual').classList.remove('text-gray-600', 'hover:bg-gray-50');
                document.getElementById('tab-upload').classList.remove('tab-active');
                document.getElementById('tab-upload').classList.add('text-gray-600');
            }
        }

        // Add experience entry
        function addExperience() {
            const container = document.getElementById('experienceContainer');
            const id = experienceCount++;
            const html = `
                <div class="border border-gray-200 rounded-lg p-4 bg-gray-50" id="exp-${id}">
                    <div class="flex justify-between items-center mb-3">
                        <h4 class="font-semibold text-gray-700">Experience #${id + 1}</h4>
                        <button type="button" onclick="removeExperience(${id})" class="text-red-500 hover:text-red-700 text-sm">Remove</button>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        <input type="text" name="exp_role_${id}" placeholder="Job Title *" required class="px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                        <input type="text" name="exp_company_${id}" placeholder="Company Name *" required class="px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                        <input type="text" name="exp_start_${id}" placeholder="Start Date (e.g., Jan 2020)" class="px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                        <input type="text" name="exp_end_${id}" placeholder="End Date (or 'Present')" class="px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                    </div>
                    <textarea name="exp_desc_${id}" placeholder="Job responsibilities and achievements..." rows="3" class="w-full mt-3 px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"></textarea>
                </div>
            `;
            container.insertAdjacentHTML('beforeend', html);
        }

        function removeExperience(id) {
            document.getElementById(`exp-${id}`).remove();
        }

        // Add education entry
        function addEducation() {
            const container = document.getElementById('educationContainer');
            const id = educationCount++;
            const html = `
                <div class="border border-gray-200 rounded-lg p-4 bg-gray-50" id="edu-${id}">
                    <div class="flex justify-between items-center mb-3">
                        <h4 class="font-semibold text-gray-700">Education #${id + 1}</h4>
                        <button type="button" onclick="removeEducation(${id})" class="text-red-500 hover:text-red-700 text-sm">Remove</button>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        <input type="text" name="edu_degree_${id}" placeholder="Degree *" required class="px-3 py-2 border rounded-lg focus:ring-2 focus:ring-green-500">
                        <input type="text" name="edu_school_${id}" placeholder="School/University *" required class="px-3 py-2 border rounded-lg focus:ring-2 focus:ring-green-500">
                        <input type="text" name="edu_year_${id}" placeholder="Year (e.g., 2020 or 2016-2020)" class="px-3 py-2 border rounded-lg focus:ring-2 focus:ring-green-500">
                    </div>
                </div>
            `;
            container.insertAdjacentHTML('beforeend', html);
        }

        function removeEducation(id) {
            document.getElementById(`edu-${id}`).remove();
        }

        // Add project entry
        function addProject() {
            const container = document.getElementById('projectsContainer');
            const id = projectCount++;
            const html = `
                <div class="border border-gray-200 rounded-lg p-4 bg-gray-50" id="proj-${id}">
                    <div class="flex justify-between items-center mb-3">
                        <h4 class="font-semibold text-gray-700">Project #${id + 1}</h4>
                        <button type="button" onclick="removeProject(${id})" class="text-red-500 hover:text-red-700 text-sm">Remove</button>
                    </div>
                    <div class="grid grid-cols-1 gap-3">
                        <input type="text" name="proj_title_${id}" placeholder="Project Title *" required class="px-3 py-2 border rounded-lg focus:ring-2 focus:ring-orange-500">
                        
                        <div class="flex gap-2">
                            <input type="url" name="proj_github_${id}" id="proj_github_${id}" placeholder="GitHub Repository URL (optional)" class="flex-1 px-3 py-2 border rounded-lg focus:ring-2 focus:ring-orange-500">
                            <button type="button" onclick="fetchGitHubProject(${id})" class="bg-gray-700 text-white px-4 py-2 rounded-lg hover:bg-gray-800 transition text-sm whitespace-nowrap">
                                üì• Auto-fill
                            </button>
                        </div>
                        
                        <input type="text" name="proj_tech_${id}" id="proj_tech_${id}" placeholder="Technologies Used (e.g., React, Node.js)" class="px-3 py-2 border rounded-lg focus:ring-2 focus:ring-orange-500">
                        <textarea name="proj_desc_${id}" id="proj_desc_${id}" placeholder="Project description..." rows="2" class="px-3 py-2 border rounded-lg focus:ring-2 focus:ring-orange-500"></textarea>
                        <input type="url" name="proj_link_${id}" id="proj_link_${id}" placeholder="Live Demo Link (optional)" class="px-3 py-2 border rounded-lg focus:ring-2 focus:ring-orange-500">
                    </div>
                </div>
            `;
            container.insertAdjacentHTML('beforeend', html);
        }

        function removeProject(id) {
            document.getElementById(`proj-${id}`).remove();
        }

        // Fetch GitHub project details
        async function fetchGitHubProject(id) {
            const githubUrl = document.getElementById(`proj_github_${id}`).value;
            if (!githubUrl) {
                alert('Please enter a GitHub URL first');
                return;
            }

            // Extract owner/repo from URL
            const match = githubUrl.match(/github\.com\/([^\/]+)\/([^\/]+)/);
            if (!match) {
                alert('Invalid GitHub URL format');
                return;
            }

            const [, owner, repo] = match;
            const cleanRepo = repo.replace(/\.git$/, '');

            try {
                const response = await fetch(`https://api.github.com/repos/${owner}/${cleanRepo}`);
                if (!response.ok) throw new Error('Repository not found');
                
                const data = await response.json();
                
                // Auto-fill fields
                if (!document.getElementsByName(`proj_title_${id}`)[0].value) {
                    document.getElementsByName(`proj_title_${id}`)[0].value = data.name;
                }
                
                if (!document.getElementsByName(`proj_desc_${id}`)[0].value && data.description) {
                    document.getElementsByName(`proj_desc_${id}`)[0].value = data.description;
                }
                
                if (!document.getElementsByName(`proj_tech_${id}`)[0].value && data.language) {
                    document.getElementsByName(`proj_tech_${id}`)[0].value = data.language;
                }
                
                if (!document.getElementsByName(`proj_link_${id}`)[0].value && data.homepage) {
                    document.getElementsByName(`proj_link_${id}`)[0].value = data.homepage;
                }

                alert('‚úÖ Project details fetched successfully!');
            } catch (error) {
                alert('‚ùå Error: ' + error.message);
            }
        }

        // Handle file upload
        async function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const formData = new FormData();
            formData.append('file', file);

            document.getElementById('uploadProgress').classList.remove('hidden');
            document.getElementById('uploadError').classList.add('hidden');

            try {
                const response = await fetch('/api/parse-resume', {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.detail || 'Failed to parse resume');
                }

                const result = await response.json();
                portfolioData = result.portfolio_data;
                const validation = result.validation;
                
                // Show validation results
                showValidationResults(validation);
                showPreview();
                
            } catch (error) {
                const errorDiv = document.getElementById('uploadError');
                errorDiv.textContent = '‚ùå Error: ' + error.message;
                errorDiv.classList.remove('hidden');
            } finally {
                document.getElementById('uploadProgress').classList.add('hidden');
            }
        }

        // Handle manual form submission
        document.getElementById('manualForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            // Collect experience data
            const experiences = [];
            for (let i = 0; i < experienceCount; i++) {
                const expDiv = document.getElementById(`exp-${i}`);
                if (expDiv) {
                    const role = document.getElementsByName(`exp_role_${i}`)[0]?.value;
                    const company = document.getElementsByName(`exp_company_${i}`)[0]?.value;
                    const start_date = document.getElementsByName(`exp_start_${i}`)[0]?.value;
                    const end_date = document.getElementsByName(`exp_end_${i}`)[0]?.value;
                    const description = document.getElementsByName(`exp_desc_${i}`)[0]?.value;
                    
                    if (role && company) {
                        experiences.push({
                            role,
                            company,
                            start_date: start_date || "Not specified",
                            end_date: end_date || undefined,
                            description: description || "No description provided"
                        });
                    }
                }
            }

            // Collect education data
            const education = [];
            for (let i = 0; i < educationCount; i++) {
                const eduDiv = document.getElementById(`edu-${i}`);
                if (eduDiv) {
                    const degree = document.getElementsByName(`edu_degree_${i}`)[0]?.value;
                    const school = document.getElementsByName(`edu_school_${i}`)[0]?.value;
                    const year = document.getElementsByName(`edu_year_${i}`)[0]?.value;
                    
                    if (degree && school) {
                        education.push({
                            degree,
                            school,
                            year: year || "Not specified"
                        });
                    }
                }
            }

            // Collect projects data
            const projects = [];
            for (let i = 0; i < projectCount; i++) {
                const projDiv = document.getElementById(`proj-${i}`);
                if (projDiv) {
                    const title = document.getElementsByName(`proj_title_${i}`)[0]?.value;
                    const tech_stack = document.getElementsByName(`proj_tech_${i}`)[0]?.value;
                    const description = document.getElementsByName(`proj_desc_${i}`)[0]?.value;
                    const link = document.getElementsByName(`proj_link_${i}`)[0]?.value;
                    
                    if (title) {
                        projects.push({
                            title,
                            tech_stack: tech_stack || "Various technologies",
                            description: description || "Project description",
                            link: link || undefined
                        });
                    }
                }
            }

            portfolioData = {
                personal_info: {
                    name: document.getElementById('name').value,
                    email: document.getElementById('email').value,
                    phone: document.getElementById('phone').value || undefined,
                    location: document.getElementById('location').value || undefined,
                    linkedin: document.getElementById('linkedin').value || undefined,
                    github: document.getElementById('github').value || undefined,
                    bio: document.getElementById('bio').value || undefined
                },
                skills: document.getElementById('skills').value.split(',').map(s => s.trim()).filter(s => s),
                experience: experiences,
                education: education,
                projects: projects,
                theme: getSelectedTheme()
            };

            showPreview();
        });

        // Get selected theme
        function getSelectedTheme() {
            const themeRadio = document.querySelector('input[name="theme"]:checked');
            const isDark = document.getElementById('themeDarkMode')?.checked;
            const themeName = themeRadio ? themeRadio.value : 'professional';
            return isDark ? `${themeName}-dark` : themeName;
        }

        // Dark mode toggle for builder
        function toggleDarkMode() {
            document.body.classList.toggle('dark-theme');
            localStorage.setItem('builderDarkMode', document.body.classList.contains('dark-theme'));
        }

        // Load dark mode preference
        if (localStorage.getItem('builderDarkMode') === 'true') {
            document.body.classList.add('dark-theme');
        }

        // Show data preview
        function showPreview() {
            // Update theme in portfolio data
            if (portfolioData) {
                const aiThemeRadio = document.querySelector('input[name="aiTheme"]:checked');
                const aiIsDark = document.getElementById('aiThemeDarkMode')?.checked;
                if (aiThemeRadio) {
                    const themeName = aiThemeRadio.value;
                    portfolioData.theme = aiIsDark ? `${themeName}-dark` : themeName;
                }
            }
            
            document.getElementById('jsonPreview').textContent = JSON.stringify(portfolioData, null, 2);
            document.getElementById('dataPreview').classList.remove('hidden');
            document.getElementById('dataPreview').scrollIntoView({ behavior: 'smooth' });
        }

        // Show validation results
        function showValidationResults(validation) {
            const resultsDiv = document.getElementById('validationResults');
            if (!validation) {
                resultsDiv.classList.add('hidden');
                return;
            }

            const score = validation.completeness_score || 0;
            const isComplete = validation.is_complete || false;
            const missing = validation.missing_items || [];
            const suggestions = validation.suggestions || [];

            let scoreColor = 'red';
            let scoreEmoji = '‚ùå';
            if (score >= 95) {
                scoreColor = 'green';
                scoreEmoji = '‚úÖ';
            } else if (score >= 80) {
                scoreColor = 'yellow';
                scoreEmoji = '‚ö†Ô∏è';
            }

            let html = `
                <div class="border-2 rounded-lg p-6 ${isComplete ? 'border-green-500 bg-green-50' : 'border-yellow-500 bg-yellow-50'}">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-xl font-bold text-gray-800">Resume Parsing Validation</h3>
                        <div class="text-3xl">${scoreEmoji}</div>
                    </div>
                    
                    <div class="mb-4">
                        <div class="flex items-center justify-between mb-2">
                            <span class="font-semibold">Completeness Score:</span>
                            <span class="text-2xl font-bold text-${scoreColor}-600">${score}%</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-3">
                            <div class="bg-${scoreColor}-600 h-3 rounded-full transition-all duration-500" style="width: ${score}%"></div>
                        </div>
                    </div>`;

            if (missing.length > 0) {
                html += `
                    <div class="mb-4">
                        <h4 class="font-bold text-red-700 mb-2">‚ö†Ô∏è Missing Information:</h4>
                        <ul class="list-disc pl-6 text-sm text-gray-700 space-y-1">
                            ${missing.map(item => `<li>${item}</li>`).join('')}
                        </ul>
                    </div>`;
            }

            if (suggestions.length > 0) {
                html += `
                    <div class="mb-4">
                        <h4 class="font-bold text-blue-700 mb-2">üí° Suggestions:</h4>
                        <ul class="list-disc pl-6 text-sm text-gray-700 space-y-1">
                            ${suggestions.map(item => `<li>${item}</li>`).join('')}
                        </ul>
                    </div>`;
            }

            if (!isComplete) {
                html += `
                    <div class="mt-4 flex gap-3">
                        <button onclick="reparseResume()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition text-sm font-semibold">
                            üîÑ Re-parse Resume
                        </button>
                        <button onclick="document.getElementById('validationResults').classList.add('hidden')" class="bg-gray-400 text-white px-4 py-2 rounded-lg hover:bg-gray-500 transition text-sm">
                            Dismiss
                        </button>
                    </div>`;
            }

            html += `</div>`;
            resultsDiv.innerHTML = html;
            resultsDiv.classList.remove('hidden');
        }

        // Re-parse resume (reload file input)
        function reparseResume() {
            const fileInput = document.getElementById('resumeFile');
            if (fileInput && fileInput.files[0]) {
                // Trigger re-parse by simulating file change
                fileInput.dispatchEvent(new Event('change'));
            } else {
                alert('Please upload your resume again');
            }
        }

        // Show portfolio preview in modal
        async function showPortfolioPreview() {
            if (!portfolioData) {
                alert('No portfolio data available');
                return;
            }

            try {
                const response = await fetch('/api/preview', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(portfolioData)
                });

                if (!response.ok) {
                    throw new Error('Failed to generate preview');
                }

                const result = await response.json();
                const previewFrame = document.getElementById('previewFrame');
                previewFrame.srcdoc = result.html;
                
                document.getElementById('previewModal').classList.remove('hidden');
            } catch (error) {
                alert('Error generating preview: ' + error.message);
            }
        }

        // Close preview modal
        function closePreviewModal() {
            document.getElementById('previewModal').classList.add('hidden');
        }

        // Update theme when radio buttons change
        document.addEventListener('change', (e) => {
            if (e.target.name === 'aiTheme' || e.target.id === 'aiThemeDarkMode') {
                if (portfolioData) {
                    showPreview();
                }
            }
        });

        // Edit data (simple JSON editor)
        function editData() {
            const newData = prompt('Edit your portfolio data (JSON format):', JSON.stringify(portfolioData, null, 2));
            if (newData) {
                try {
                    portfolioData = JSON.parse(newData);
                    showPreview();
                } catch (e) {
                    alert('Invalid JSON format!');
                }
            }
        }

        // Publish portfolio
        async function publishPortfolio() {
            document.getElementById('publishProgress').classList.remove('hidden');
            document.getElementById('publishBtn').disabled = true;

            try {
                // Get selected platform
                const platform = document.querySelector('input[name="platform"]:checked')?.value || 'cloudflare';
                
                const response = await fetch(`/api/publish?platform=${platform}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(portfolioData)
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.detail || 'Failed to publish portfolio');
                }

                const result = await response.json();
                
                // Show success
                document.getElementById('siteUrl').href = result.site_url;
                document.getElementById('siteUrl').textContent = result.site_url;
                document.getElementById('pdfUrl').href = result.pdf_url;
                
                document.getElementById('dataPreview').classList.add('hidden');
                document.getElementById('successResult').classList.remove('hidden');
                document.getElementById('successResult').scrollIntoView({ behavior: 'smooth' });
                
            } catch (error) {
                alert('‚ùå Error: ' + error.message);
            } finally {
                document.getElementById('publishProgress').classList.add('hidden');
                document.getElementById('publishBtn').disabled = false;
            }
        }

        // Reset form
        function resetForm() {
            location.reload();
        }

        // Drag and drop support
        const uploadArea = document.querySelector('.upload-area');
        
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragging');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragging');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragging');
            
            const file = e.dataTransfer.files[0];
            if (file && file.type === 'application/pdf') {
                document.getElementById('resumeFile').files = e.dataTransfer.files;
                handleFileUpload({ target: { files: [file] } });
            } else {
                alert('Please upload a PDF file');
            }
        });

        // Initialize with one entry for each section
        window.addEventListener('DOMContentLoaded', () => {
            addExperience();
            addEducation();
            addProject();
        });
    </script>
</body>
</html>
